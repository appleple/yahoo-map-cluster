!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.YmapCluster=e():t.YmapCluster=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="bundle",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(){function t(t,e,n){this.center=new Y.LatLng(0,0),this.marker=null,this.label=null,this.clusterOption=n,this.cluster=e,this.map=t,this.sums=0}return t.prototype.setSums=function(t){this.sums=t},t.prototype.hide=function(){this.marker&&this.map.removeFeature(this.marker),this.label&&this.map.removeFeature(this.label)},t.prototype.setCenter=function(t){this.center=t},t.prototype.getClusterSize=function(){for(var t=this.sums,e=1;t/10>=1;)t/=10,e++;return e},t.prototype.show=function(){this.marker&&this.map.removeFeature(this.marker),this.label&&this.map.removeFeature(this.label);var t=this.clusterOption.getClusterSize?this.clusterOption.getClusterSize(this.sums):this.getClusterSize(),e=new Y.Icon(""+this.clusterOption.imagePath+t+".png",{iconSize:new Y.Size(53,52),className:"ymap-cluster-icon"});this.marker=new Y.Marker(this.center,{icon:e}),this.map.addFeature(this.marker),this.label=new Y.Label(this.center,""+this.sums,{className:"ymap-cluster-label"}),this.map.addFeature(this.label),this.onAdd(this.marker)},t.prototype.onAdd=function(t){var e=this;this.marker&&this.marker.bind("click",function(){var t=e.cluster.getCenter(),n=e.cluster.getBounds();if(n&&t){var r=e.map.getBoundsZoomLevel(n);e.map.setZoom(r,!0,t,!0)}}),this.label&&this.label.bind("click",function(){var t=e.cluster.getCenter(),n=e.cluster.getBounds();if(n&&t){var r=e.map.getBoundsZoomLevel(n);e.map.setZoom(r,!0,t,!0)}})},t}(),i={gridSize:60,minClusterSize:2,maxZoom:null,imagePath:"https://appleple.github.io/yahoo-map-cluster/images/cluster/"},s=function(){function t(t,e){this.markers=[],this.center=null,this.bounds=null;var n=Object.assign({},i,e);this.map=t,this.gridSize=n.gridSize,this.option=n,this.clusterIcon=new r(this.map,this,this.option)}return t.prototype.calculateBounds=function(){if(this.center){var t=new Y.LatLngBounds(this.center,this.center);this.bounds=this.getExtendedBounds(t)}},t.prototype.getExtendedBounds=function(t){var e=this.map.getZoom(),n=this.map.getProjection(),r=new Y.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),i=new Y.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),s=n.fromLatLngToPixel(r,e);s.x+=this.gridSize,s.y-=this.gridSize;var o=n.fromLatLngToPixel(i,e);o.x-=this.gridSize,o.y+=this.gridSize;var a=n.fromPixelToLatLng(s,e),u=n.fromPixelToLatLng(o,e);return t.extend(a),t.extend(u),t},t.prototype.getCenter=function(){return this.center},t.prototype.getBounds=function(){return this.bounds},t.prototype.addMarker=function(t){var e=this.option,n=this.map,r=e.minClusterSize;if(this.isMarkerAlreadyAdded(t))return!1;if(this.center){var i=this.markers.length+1,s=(this.center.lat()*(i-1)+t.getLatLng().lat())/i,o=(this.center.lng()*(i-1)+t.getLatLng().lng())/i;this.center=new Y.LatLng(s,o)}else this.center=t.getLatLng();this.calculateBounds(),this.markers.push(t);var a=this.markers.length;if(a<r&&n.addFeature(t),a===r)for(var u=0;u<a;u++)n.removeFeature(this.markers[u]);a>=r&&n.removeFeature(t),this.updateIcon()},t.prototype.isMarkerInClusterBounds=function(t){return!!this.bounds&&this.bounds.containsLatLng(t.getLatLng())},t.prototype.isMarkerAlreadyAdded=function(t){return!!this.markers.find(function(e){return e===t})},t.prototype.getMaxZoom=function(){return this.option.maxZoom},t.prototype.hide=function(){this.clusterIcon.hide()},t.prototype.updateIcon=function(){var t=this,e=this.map.getZoom(),n=this.getMaxZoom();if(n&&e>n)this.markers.forEach(function(e){t.map.addFeature(e)});else if(this.markers.length<this.option.minClusterSize)this.clusterIcon.hide();else{var r=this.markers.length;this.clusterIcon.setSums(r),this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.show()}},t}(),o=function(){function t(t,e,n){void 0===n&&(n={});var r=this;this.clusters=[],this.markers=e,this.map=t,this.options=n,this.createClusters(),this.map.bind("zoomend",function(){r.update()}),this.appendStyle()}return t.prototype.appendStyle=function(){var t=document.querySelector("body");if(t){!function(t,e){var n=document.createElement("div");for(n.innerHTML=e;n.children.length>0;)t.appendChild(n.children[0])}(t,'<style id="ymap-cluster"></style>');var e=document.querySelector("#ymap-cluster"),n=this.options.injectStyle?this.options.injectStyle():"",r=n||'\n      .ymap-cluster-label {\n        z-index: 2;\n        font-size: 14px;\n        width: 30px;\n        text-align: center;\n        position: absolute;\n        top: -13px;\n        left: -15px;\n        margin: 0 !important;\n        font-family: Hiragino Kaku Gothic Pro","ヒラギノ角ゴ Pro W3",Meiryo,"メイリオ","ＭＳ Ｐゴシック","MS PGothic",Verdana,sans-serif;\n      }\n      .ymap-cluster-icon {\n        margin-top: -28px !important;\n        z-index: 0 !important;\n      }\n      ';e&&(e.innerHTML=r)}},t.prototype.createClusters=function(){var t=this;this.markers.forEach(function(e){t.addToClosestCluster(e)})},t.prototype.distanceBetweenPoints=function(t,e){var n=(e.lat()-t.lat())*Math.PI/180,r=(e.lng()-t.lng())*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},t.prototype.getClosestCluster=function(t){var e=this,n=1/0,r=null;return this.clusters.forEach(function(i){var s=i.getCenter();if(s){var o=e.distanceBetweenPoints(s,t.getLatLng());o<n&&(n=o,r=i)}}),r},t.prototype.addToClosestCluster=function(t){this.clusters;var e=this.options,n=this.getClosestCluster(t);if(n&&n.isMarkerInClusterBounds(t))n.addMarker(t);else{var r=new s(this.map,e);r.addMarker(t),this.clusters.push(r)}},t.prototype.update=function(){var t=this;this.clusters.forEach(function(t){t.hide()}),this.clusters=[],this.markers.forEach(function(e){t.map.removeFeature(e)}),this.createClusters()},t.prototype.addMarker=function(t,e){e&&(this.markers.push(t),this.update())},t}();e.default=o}]).default});