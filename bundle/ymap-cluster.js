!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.YmapCluster=e():t.YmapCluster=e()}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="bundle",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var n=function(){function t(t,e,r){this.center=new Y.LatLng(0,0),this.marker=null,this.clusterOption=r,this.cluster=e,this.map=t}return t.prototype.hide=function(){this.marker&&this.map.removeFeature(this.marker)},t.prototype.setCenter=function(t){this.center=t},t.prototype.show=function(){this.marker&&this.map.removeFeature(this.marker);var t=new Y.Icon("./images/cluster.png",{iconSize:new Y.Size(32,32)});this.marker=new Y.Marker(this.center,{icon:t}),this.map.addFeature(this.marker),this.onAdd(this.marker)},t.prototype.onAdd=function(t){var e=this;this.marker&&this.marker.bind("click",function(){var t=e.cluster.getCenter(),r=e.cluster.getBounds();if(r&&t){var n=e.map.getBoundsZoomLevel(r);e.map.setZoom(n,!0,t,!0)}})},t}(),i={gridSize:60,minClusterSize:2,maxZoom:null},o=function(){function t(t,e){this.markers=[],this.center=null,this.bounds=null;var r=Object.assign({},i,e);this.map=t,this.gridSize=r.gridSize,this.option=r,this.clusterIcon=new n(this.map,this,this.option)}return t.prototype.calculateBounds=function(){if(this.center){var t=new Y.LatLngBounds(this.center,this.center);this.bounds=this.getExtendedBounds(t)}},t.prototype.getExtendedBounds=function(t){var e=this.map.getZoom(),r=this.map.getProjection(),n=new Y.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),i=new Y.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),o=r.fromLatLngToPixel(n,e);o.x+=this.gridSize,o.y-=this.gridSize;var s=r.fromLatLngToPixel(i,e);s.x-=this.gridSize,s.y+=this.gridSize;var a=r.fromPixelToLatLng(o,e),u=r.fromPixelToLatLng(s,e);return t.extend(a),t.extend(u),t},t.prototype.getCenter=function(){return this.center},t.prototype.getBounds=function(){return this.bounds},t.prototype.addMarker=function(t){var e=this.option,r=this.map,n=e.minClusterSize;if(this.isMarkerAlreadyAdded(t))return!1;if(this.center){var i=this.markers.length+1,o=(this.center.lat()*(i-1)+t.getLatLng().lat())/i,s=(this.center.lng()*(i-1)+t.getLatLng().lng())/i;this.center=new Y.LatLng(o,s)}else this.center=t.getLatLng();this.calculateBounds(),this.markers.push(t);var a=this.markers.length;if(a<n&&r.addFeature(t),a===n)for(var u=0;u<a;u++)r.removeFeature(this.markers[u]);a>=n&&r.removeFeature(t),this.updateIcon()},t.prototype.isMarkerInClusterBounds=function(t){return!!this.bounds&&this.bounds.containsLatLng(t.getLatLng())},t.prototype.isMarkerAlreadyAdded=function(t){return!!this.markers.find(function(e){return e===t})},t.prototype.getMaxZoom=function(){return this.option.maxZoom},t.prototype.hide=function(){this.clusterIcon.hide()},t.prototype.updateIcon=function(){var t=this,e=this.map.getZoom(),r=this.getMaxZoom();r&&e>r?this.markers.forEach(function(e){t.map.addFeature(e)}):this.markers.length<this.option.minClusterSize?this.clusterIcon.hide():(this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.show())},t}(),s=function(){function t(t,e,r){void 0===r&&(r={});var n=this;this.clusters=[],this.markers=e,this.map=t,this.options=r,this.createClusters(),this.map.bind("zoomend",function(){n.update()})}return t.prototype.createClusters=function(){var t=this;this.markers.forEach(function(e){t.addToClosestCluster(e)})},t.prototype.distanceBetweenPoints=function(t,e){var r=(e.lat()-t.lat())*Math.PI/180,n=(e.lng()-t.lng())*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},t.prototype.getClosestCluster=function(t){var e=this,r=1/0,n=null;return this.clusters.forEach(function(i){var o=i.getCenter();if(o){var s=e.distanceBetweenPoints(o,t.getLatLng());s<r&&(r=s,n=i)}}),n},t.prototype.addToClosestCluster=function(t){this.clusters;var e=this.options,r=this.getClosestCluster(t);if(r&&r.isMarkerInClusterBounds(t))r.addMarker(t);else{var n=new o(this.map,e);n.addMarker(t),this.clusters.push(n)}},t.prototype.update=function(){var t=this;this.clusters.forEach(function(t){t.hide()}),this.clusters=[],this.markers.forEach(function(e){t.map.removeFeature(e)}),this.createClusters()},t.prototype.addMarker=function(t,e){e&&(this.markers.push(t),this.update())},t}();e.default=s}]).default});